Komut Enjeksiyonu â€“ Ã–rnek Kodlarla SaldÄ±rÄ± ve Savunma
(White-Box ve Black-Box Perspektifi)

Bu bÃ¶lÃ¼mde aynÄ± iÅŸlevin:

Zafiyetli (saldÄ±rÄ±ya aÃ§Ä±k)

SÃ¶mÃ¼rÃ¼lmÃ¼ÅŸ (exploit edilmiÅŸ)

GÃ¼venli (defansif)

YanlÄ±ÅŸ ama sÄ±k sanÄ±lan â€œgÃ¼venliâ€

hÃ¢llerini gÃ¶receksin.

1ï¸âƒ£ ZAFÄ°YETLÄ° KOD (Command Injection VARDIR)
Senaryo

KullanÄ±cÄ±dan IP alÄ±p ping atan bir web servisi.

âŒ Python â€“ Zafiyetli Kod
import os
from flask import Flask, request

app = Flask(__name__)

@app.route("/ping")
def ping():
    ip = request.args.get("ip")
    os.system("ping -c 1 " + ip)
    return "Ping gÃ¶nderildi"

White-Box Analiz
Kontrol	Durum
KullanÄ±cÄ± girdisi	âœ… Var
Shell Ã§aÄŸrÄ±sÄ±	âœ… os.system
String birleÅŸtirme	âœ… Var
Shell operatÃ¶rleri Ã§alÄ±ÅŸÄ±r mÄ±	âœ… Evet

â¡ Kesin komut enjeksiyonu

2ï¸âƒ£ SALDIRI (EXPLOIT)
Black-Box Payload
8.8.8.8; whoami

GerÃ§ekte Ã‡alÄ±ÅŸan Komut
ping -c 1 8.8.8.8; whoami

SonuÃ§

ping Ã§alÄ±ÅŸÄ±r

whoami Ã§alÄ±ÅŸÄ±r

SaldÄ±rgan uygulamanÄ±n Ã§alÄ±ÅŸtÄ±ÄŸÄ± kullanÄ±cÄ±yÄ± Ã¶ÄŸrenir

â¡ OS seviyesinde keyfi komut yÃ¼rÃ¼tme

3ï¸âƒ£ BLIND (KÃ–R) COMMAND INJECTION Ã–RNEÄÄ°
Payload
8.8.8.8; sleep 10

GÃ¶zlem

HTTP yanÄ±tÄ± 10 saniye gecikir

â¡ Ã‡Ä±ktÄ± yok ama komut Ã§alÄ±ÅŸÄ±yor
â¡ Blind Command Injection

4ï¸âƒ£ â€œBU COMMAND INJECTION DEÄÄ°Lâ€ Ã–RNEÄÄ° (Ã‡OK Ã–NEMLÄ°)
âœ… GÃ¼venli Python Kodu
import subprocess

@app.route("/ping")
def ping():
    ip = request.args.get("ip")
    subprocess.run(
        ["ping", "-c", "1", ip],
        shell=False
    )
    return "Ping gÃ¶nderildi"

AynÄ± Payload
8.8.8.8; whoami

SonuÃ§
ping: unknown host 8.8.8.8; whoami

Analiz
Kriter	SonuÃ§
Komut Ã§alÄ±ÅŸtÄ± mÄ±	âŒ
Shell yorumladÄ± mÄ±	âŒ
OS komutu yÃ¼rÃ¼tÃ¼ldÃ¼ mÃ¼	âŒ

â¡ Bu Command Injection DEÄÄ°LDÄ°R

5ï¸âƒ£ â€œYANLIÅ GÃœVENLÄ°â€ KOD (SÄ±k YapÄ±lan Hata)
âŒ Kara Liste ile â€œKorumaâ€
ip = request.args.get("ip")
ip = ip.replace(";", "")
os.system("ping -c 1 " + ip)

Bypass Payload
8.8.8.8 && whoami


â¡ HÃ¢lÃ¢ kÄ±rÄ±lÄ±r

Kara liste â‰  Savunma

6ï¸âƒ£ GERÃ‡EK SAVUNMA â€“ WHITELIST + PARAMETRELÄ° Ã‡AÄRI
âœ… GÃ¼venli ve DoÄŸru Ã‡Ã¶zÃ¼m
import re
import subprocess

ip = request.args.get("ip")

ip_regex = r"^\d{1,3}(\.\d{1,3}){3}$"
if not re.match(ip_regex, ip):
    return "GeÃ§ersiz IP", 400

subprocess.run(
    ["ping", "-c", "1", ip],
    shell=False
)

Savunma KatmanlarÄ±
Katman	Var mÄ±
Shell kaldÄ±rÄ±ldÄ±	âœ…
Parametreli Ã§aÄŸrÄ±	âœ…
Whitelist	âœ…
Kara liste	âŒ
Regex	âœ…

â¡ Command Injection Ä°MKÃ‚NSIZ

7ï¸âƒ£ ORTAM DEÄÄ°ÅKENÄ° KAYNAKLI COMMAND INJECTION (WHITE-BOX)
âŒ C â€“ Zafiyetli Kod
system("make");

White-Box Sorun

make tam yol deÄŸil

$PATH manipÃ¼le edilebilir

ğŸ”´ SaldÄ±rÄ±
export PATH=/tmp/malicious:$PATH


â¡ ZararlÄ± make root olarak Ã§alÄ±ÅŸÄ±r

âœ… GÃ¼venli HÃ¢li
system("/usr/bin/make");


veya

execve("/usr/bin/make", args, clean_env);

8ï¸âƒ£ Node.js Ã–rneÄŸi (Ã‡OK SORULUR)
âŒ Zafiyetli
const { exec } = require("child_process");

exec("ls " + userInput);

âœ… GÃ¼venli
const { execFile } = require("child_process");

execFile("/bin/ls", [userInput]);

9ï¸âƒ£ NET KARÅILAÅTIRMA TABLOSU
Kod	Command Injection
os.system()	âŒ Var
exec()	âŒ Var
shell=True	âŒ Var
execFile()	âœ… Yok
subprocess.run(..., shell=False)	âœ… Yok
YerleÅŸik API	âœ… Yok
ğŸ”š SONUÃ‡ (EN NET HALÄ°YLE)

Command Injection vardÄ±r eÄŸer:

Shell Ã§alÄ±ÅŸÄ±yorsa

KullanÄ±cÄ± girdisi shellâ€™e gidiyorsa

Girdi komut olarak yorumlanÄ±yorsa

Command Injection yoktur eÄŸer:

Shell yoksa

Girdi sadece argÃ¼mansa

Parametreli Ã§aÄŸrÄ± varsa

En iyi savunma: Shellâ€™i Ã¶ldÃ¼r.

KaynakÃ§a:
https://owasp.org/www-project-cheat-sheets/cheatsheets/OS_Command_Injection_Defense_Cheat_Sheet.html
https://owasp.org/Top10/2021/A03_2021-Injection/
https://cwe.mitre.org/data/definitions/78.html
https://portswigger.net/web-security/os-command-injection
https://portswigger.net/burp/documentation/desktop/testing-workflow/input-validation/command-injection
https://attack.mitre.org/techniques/T1059/
https://csrc.nist.gov/publications/detail/sp/800-53/rev-5/final
https://docs.aws.amazon.com/codeguru/detector-library/c/os-command-injection/
https://docs.aws.amazon.com/codeguru/detector-library/php/os-command-injection/
https://www.veracode.com/security/cwe-78
https://www.sans.org/top25-software-errors/cwe-78/